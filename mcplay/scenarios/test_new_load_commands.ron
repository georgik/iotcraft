(
  name: "Test New MCP Load Commands",
  description: "Test the new load_world_from_fs and load_world_from_mqtt MCP commands",
  version: "1.0",
  infrastructure: (
    mqtt_server: (
      required: true,
      port: 1883,
      config_file: None,
      options: None,
    ),
    mqtt_observer: Some((
      required: true, 
      topics: Some(["#"]),
      client_id: Some("observer_new_load_test"),
    )),
    mcp_server: None,
    services: None,
  ),
  clients: [
    (
      id: "alice",
      player_id: "alice",
      mcp_port: 3001,
      client_type: "desktop",
      name: Some("Alice - New Load Commands Test"),
      config: Some({
        "enable_mcp": true,
        "readiness_probe": {
          "type": "tcp_port", 
          "port": 3001,
          "initial_delay_seconds": 5,
          "timeout_seconds": 10
        },
        "liveness_probe": {
          "type": "mcp_ping",
          "interval_seconds": 30,
          "timeout_seconds": 10,
          "failure_threshold": 5
        }
      }),
    )
  ],
  steps: [
    // Check that the new tools are available in tools/list
    (
      name: "alice_check_tools_list",
      description: "Alice checks for the new load_world_from_fs and load_world_from_mqtt commands",
      client: "alice",
      action: (
        type: "mcp_call",
        tool: "tools/list",
        arguments: {},
      ),
      depends_on: [],
      wait_before: 1000,
      wait_after: 2000,
      timeout: 10000,
      success_condition: None,
    ),
    
    // Alice creates a world for testing
    (
      name: "alice_create_test_world",
      description: "Alice creates a new world for testing the new load commands",
      client: "alice",
      action: (
        type: "mcp_call",
        tool: "create_world",
        arguments: {
          "world_name": "new_load_test_world",
          "description": "Test world for new load commands",
          "template": "default"
        },
      ),
      depends_on: ["alice_check_tools_list"],
      wait_before: 1000,
      wait_after: 8000,  // Wait for template to complete
      timeout: 30000,
      success_condition: None,
    ),
    
    // Test load_world_from_fs command
    (
      name: "alice_test_load_from_fs",
      description: "Alice tests the new load_world_from_fs command",
      client: "alice",
      action: (
        type: "mcp_call",
        tool: "load_world_from_fs",
        arguments: {
          "world_name": "new_load_test_world"
        },
      ),
      depends_on: ["alice_create_test_world"],
      wait_before: 1000,
      wait_after: 2000,
      timeout: 30000,
      success_condition: None,
    ),
    
    // Verify game state after load_world_from_fs
    (
      name: "alice_verify_state_after_fs_load",
      description: "Alice verifies she's in the game after loading from filesystem",
      client: "alice",
      action: (
        type: "mcp_call",
        tool: "get_game_state",
        arguments: {},
      ),
      depends_on: ["alice_test_load_from_fs"],
      wait_before: 1000,
      wait_after: 1000,
      timeout: 10000,
      success_condition: None,
    ),
    
    // Test load_world_from_mqtt command (should fail in single-player mode)
    (
      name: "alice_test_load_from_mqtt",
      description: "Alice tests the new load_world_from_mqtt command (expected to fail in single-player)",
      client: "alice",
      action: (
        type: "mcp_call",
        tool: "load_world_from_mqtt",
        arguments: {
          "world_name": "new_load_test_world"
        },
      ),
      depends_on: ["alice_verify_state_after_fs_load"],
      wait_before: 1000,
      wait_after: 2000,
      timeout: 15000,
      success_condition: None,
    ),
  ],
  config: Some((
    timeout_ms: Some(180000),  // 3 minutes max runtime
    logging: None,
    environment: None,
    settings: Some({
      "cleanup_on_exit": true,
      "keep_logs": true
    }),
  )),
)
